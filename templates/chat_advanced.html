<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Chat mit Protokoll</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script>
    let ws;
    function sendJoin() {
      const user = document.getElementById("user").value;
      const text = document.getElementById("text").value;

      ws = new WebSocket("ws://localhost:9001/ws");

      ws.onopen = () => {
        document.getElementById("join").style.display = "none";
        document.getElementById("chat").style.display = "block";
        ws.send(JSON.stringify({ type: "join", user, text }));
      };

      ws.onmessage = (event) => {
        const li = document.createElement("li");
        li.textContent = event.data;
        document.getElementById("messages").appendChild(li);
      };
    }
    function sendLeave() {
      if (ws && ws.readyState === WebSocket.OPEN) {
        const user = document.getElementById("user").value;
        const text = document.getElementById("text").value;
        ws.send(JSON.stringify({ type: "leave", user, text }));
        ws.close();
        document.getElementById("chat").style.display = "none";
        document.getElementById("join").style.display = "block";
        document.getElementById("messages").innerHTML = "";
      }
    }
    function sendChat() {
      const user = document.getElementById("user").value;
      const text = document.getElementById("text").value;
      ws.send(JSON.stringify({ type: "chat", user, text }));
      document.getElementById("text").value = "";
    }
    function heartbeat() {
      ws.send(JSON.stringify({ type: "ping" }));
    }
    setInterval(() => { if (ws && ws.readyState === 1) heartbeat(); }, 5000);
  </script>
</head>
<body class="container py-5">
  <h1 class="mb-4">ðŸ’¬ Live-Chat</h1>

  <div id="join" class="mb-4">
    <div class="input-group mb-2">
      <span class="input-group-text">Name</span>
      <input id="user" class="form-control" value="Max">
    </div>
    <button class="btn btn-primary" onclick="sendJoin()">Join</button>
  </div>

  <div id="chat" style="display:none;">
    <div class="input-group mb-2">
      <input id="text" class="form-control" placeholder="Nachricht">
      <button class="btn btn-success" onclick="sendChat()">Senden</button>
      <button class="btn btn-secondary ms-2" onclick="sendLeave()">Leave</button>
    </div>
    <ul id="messages" class="list-group"></ul>
  </div>
</body>
</html>
